<html>

<head>
    <meta charset="utf-8">
    <title>PyMO 游戏索引</title>

    <!-- Icons -->
    <link rel="icon" href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo.ico"
        type="image/x-icon" />
    <link rel="Shortcut Icon" href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo.ico"
        type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="144x144"
        href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo-icon-144.png" />
    <link rel="apple-touch-icon" sizes="114x114"
        href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo-icon-114.png" />
    <link rel="apple-touch-icon" sizes="72x72"
        href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo-icon-72.png" />
    <link rel="apple-touch-icon"
        href="https://raw.githubusercontent.com/pymo/pymo.github.io/master/images/pymo-icon-57.png" />
</head>

<body>
    <h1 align="center">PyMO游戏索引</h1>

    <div id="sources" align="center" hidden="true">
        <h2>选择一个源</h2>
        <br />
        <br />
        <br />
    </div>

    <div id="game-list" align="center" hidden="true">
        <h2>游戏索引</h2>
        <br />
        <br />
        <br />
    </div>

    <script type="text/javascript">

        function showSourcesList(sources) {
            let div = document.getElementById("sources");
            div.hidden = false;

            sources.forEach(src => {
                var html = "";
                html += "<a href='./index.html?source=" + src.id + "'><h3>" + src.name + "</h3></a>";
                html += "<p>" + src.desc + "</p>";
                html += "<br />"

                div.innerHTML += html;
            });
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {return pair[1];}
            }
            return false;
        }

        function showGameList(source) {
            let g = document.getElementById("game-list");
            g.hidden = false;

            fetch(source.url)
                .then((response) => response.text())
                .then((json) => g.innerText = json);
        }

        function main(sources) {
            let sourceId = getQueryVariable("source");
            let gameName = getQueryVariable("game");

            if (sourceId == false && gameName == false) {
                showSourcesList(sources);
                return;
            }

            let source = sources.find((s) => s.id == sourceId);
            if (sourceId != false)
                showGameList(source);
        }

        fetch("./sources.json")
            .then((response) => response.json())
            .then(main);
    </script>
</body>

</html>